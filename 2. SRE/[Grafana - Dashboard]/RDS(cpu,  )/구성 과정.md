## 전체

RDS의 주요 상태들을 나타내는 패널을 구성한다.

 ![결과](img/결과.png)

## 세부 설정들

### Datasource

#### IAM 생성

* `AmazonGrafanaCloudWatchAccess` 정책을 가진 IAM 역할을 생성한다.

![IAM](img/IAM.png)

#### Datasource 생성

* Authentication Provider: AWS SDK Default
* Assume Role ARN: 위에서 생성한 IAM arn

![Datasource](img/Datasource.png)

### 공통

* 시간 변화에 따른 지표 추이를 한눈에 보기위해 패널의 visualization은 <b>Time series</b>로 구성한다.
* 각 지표들의 Query를 정리한다.

#### Queries

* Datasource는 cloudwatch

### 지표

#### CPUUtilization

<b>Query</b>
![1](img/1.png)

#### RollbackSegmentHistoryListLength

* 아직 purge(정리)되지 못한 Undo Log 엔트리의 개수를 말한다.
* 지속적으로 증가하는 경우, 긴 트랜잭션이 종료되지 않고 유지되고 있거나 Purge thread가 따라잡지 못하는 상황임

<b>Query</b>
![2](img/2.png)

<b>Threshold</b>

* 100k 이상이 12h 지속되는 경우 알림을 받도록 한다.

* 임계치 설정의 근거
  한 달간의 추이를 확인하였을 때(최대 + 1h) 
  1. 보통, Peak time에 최대 200k 까지 치솟았다가 2~3시간 내로 정상 처리된다.
  2. 최악의 Case의 경우, 06시 ~ 18시 동안 유지되었다. (3.5m + 12h)

![CloudWatch](img/CloudWatch.png)